# Price Parser

–ü–∞—Ä—Å–µ—Ä —Ü–µ–Ω —Å —Å–∞–π—Ç–∞ electronpribor.ru –¥–ª—è Excel —Ñ–∞–π–ª–æ–≤.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install -r requirements.txt
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–¥–∏–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º (–æ–¥–∏–Ω –ø–∞—Ä—Å–µ—Ä)

```bash
# –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω –Ω–∞ 10 —Ç–æ–≤–∞—Ä–∞—Ö
python src/main.py --config config.yaml --parser electronpribor --limit 10

# –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
python src/main.py --config config.yaml --parser electronpribor
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Å–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

```bash
# –ó–∞–ø—É—Å–∫ –¥–≤—É—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (—ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ ~26%)
python src/main.py --config config.yaml --parsers electronpribor,prist --limit 10

# –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω —Å –¥–≤—É–º—è –ø–∞—Ä—Å–µ—Ä–∞–º–∏
python src/main.py --config config.yaml --parsers electronpribor,prist

# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø–∞—Ä—Å–µ—Ä–æ–≤ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
python src/main.py --config config.yaml --parsers electronpribor,prist,new_parser
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞:**
- ‚ö° **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏**: –¥–ª—è 8000 —Ç–æ–≤–∞—Ä–æ–≤ —ç–∫–æ–Ω–æ–º–∏—è ~36 –º–∏–Ω—É—Ç (26%)
- üìä **–û–¥–∏–Ω —Ñ–∞–π–ª**: –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –æ–¥–Ω–æ–º Excel —Ñ–∞–π–ª–µ
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**: –∫–æ–ª–æ–Ω–∫–∞ "–†–∞–∑–Ω–∏—Ü–∞ —Ü–µ–Ω" –¥–ª—è 2 –ø–∞—Ä—Å–µ—Ä–æ–≤
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ—Ç–∏–π, —á–µ—Ç–≤–µ—Ä—Ç—ã–π –ø–∞—Ä—Å–µ—Ä

## –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `--parsers` –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:

```
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:
  ‚îú‚îÄ –ü–∞—Ä—Å–µ—Ä 1 (electronpribor) ‚îÄ‚îÄ‚îê
  ‚îÇ                              ‚îú‚îÄ‚Üí asyncio.gather() ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
  ‚îî‚îÄ –ü–∞—Ä—Å–µ—Ä 2 (prist) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

Excel —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞:

| –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | –¶–µ–Ω–∞ Electronpribor | –ù–∞–∑–≤–∞–Ω–∏–µ Electronpribor | –°—Å—ã–ª–∫–∞ Electronpribor | –°—Ç–∞—Ç—É—Å Electronpribor | –¶–µ–Ω–∞ Prist | –ù–∞–∑–≤–∞–Ω–∏–µ Prist | –°—Å—ã–ª–∫–∞ Prist | –°—Ç–∞—Ç—É—Å Prist | –†–∞–∑–Ω–∏—Ü–∞ —Ü–µ–Ω | –°—Ç–∞—Ç—É—Å |
|-----------------|---------------------|------------------------|----------------------|---------------------|------------|---------------|-------------|-------------|-------------|--------|
| –ê–ö–ò–ü-3409 | 1000 | –ê–ö–ò–ü-3409/3–ê | https://... | –ù–∞–π–¥–µ–Ω–æ | 1200 | –ê–ö–ò–ü-3409/3–ê | https://... | –ù–∞–π–¥–µ–Ω–æ | 200 | –ù–∞–π–¥–µ–Ω–æ –≤–æ –≤—Å–µ—Ö |

**–°—Ç–∞—Ç—É—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞:**
- ‚úÖ **–ù–∞–π–¥–µ–Ω–æ** - —Ç–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω —Å —Ü–µ–Ω–æ–π
- üìû **–¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É** - —Ç–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω, –Ω–æ —Ü–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É
- üè≠ **–°–Ω—è—Ç —Å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞** - —Ç–æ–≤–∞—Ä —Å–Ω—è—Ç —Å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
- ‚ùå **–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ** - —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- ‚ö†Ô∏è **–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞** - –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
- ‚ùì **–ù–µ –Ω–∞–π–¥–µ–Ω–æ** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ **–ù–∞–π–¥–µ–Ω–æ –≤–æ –≤—Å–µ—Ö** - –≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –Ω–∞—à–ª–∏ —Ç–æ–≤–∞—Ä
- ‚ö†Ô∏è **–ù–∞–π–¥–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ** - —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –ø–∞—Ä—Å–µ—Ä–æ–≤ –Ω–∞—à–ª–∞ —Ç–æ–≤–∞—Ä
- ‚ùå **–ù–µ –Ω–∞–π–¥–µ–Ω–æ** - –Ω–∏ –æ–¥–∏–Ω –ø–∞—Ä—Å–µ—Ä –Ω–µ –Ω–∞—à–µ–ª —Ç–æ–≤–∞—Ä

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤

–°–∏—Å—Ç–µ–º–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è** - –¥–æ–±–∞–≤—å –Ω–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä, –∏ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

### –®–∞–≥–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞:

1. **–°–æ–∑–¥–∞–π —Ñ–∞–π–ª –ø–∞—Ä—Å–µ—Ä–∞:**
   ```
   src/parsers/{new_parser}_async_parser.py
   ```
   
   –° –∫–ª–∞—Å—Å–æ–º:
   ```python
   class {NewParser}AsyncParser(AsyncBaseParser):
       async def search_product(self, product_name: str) -> Optional[Dict[str, Any]]:
           # –¢–≤–æ—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
           return {
               'price': 1000.0,  # –∏–ª–∏ -2 (–ø–æ –∑–∞–ø—Ä–æ—Å—É), -1 (—Å–Ω—è—Ç), 0 (–Ω–µ –Ω–∞–π–¥–µ–Ω)
               'name': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
               'url': 'https://...'
           }
   ```

2. **–î–æ–±–∞–≤—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `config.yaml`:**
   ```yaml
   parser:
     new_parser:
       enabled: true
       base_url: "https://example.com"
       async:
         enabled: true
         max_concurrent: 4
         connection_pool_size: 8
         request_delay: 1.0
         batch_size: 20
         checkpoint_interval: 30
         batch_delay: 5
       retry:
         total: 3
         backoff_factor: 0.3
         status_forcelist: [429, 500, 502, 503, 504]
       timeout: 20
       user_agent: "Mozilla/5.0..."
   ```

3. **–ó–∞–ø—É—Å—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä—Å–µ—Ä–æ–º:**
   ```bash
   python src/main.py --parsers electronpribor,prist,new_parser
   ```

**–í—Å—ë!** –ö–æ–ª–æ–Ω–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- `–¶–µ–Ω–∞ {New Parser}`
- `–ù–∞–∑–≤–∞–Ω–∏–µ {New Parser}`
- `–°—Å—ã–ª–∫–∞ {New Parser}`
- `–°—Ç–∞—Ç—É—Å {New Parser}`

–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è! üéâ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
etalon-parser/
‚îú‚îÄ‚îÄ config.yaml                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_parser.py         # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (sync)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_async_parser.py   # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (async)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ factory.py             # –§–∞–±—Ä–∏–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ electronpribor_parser.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ electronpribor_async_parser.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prist_async_parser.py
‚îÇ   ‚îú‚îÄ‚îÄ excel/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reader.py              # –ß—Ç–µ–Ω–∏–µ Excel
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ writer.py              # –ó–∞–ø–∏—Å—å Excel (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞)
‚îÇ   ‚îú‚îÄ‚îÄ logger.py                  # Structlog –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config_loader.py           # –ó–∞–≥—Ä—É–∑–∫–∞ YAML
‚îÇ   ‚îî‚îÄ‚îÄ main.py                    # CLI —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ output/                        # –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ temp/                      # –í—Ä–µ–º–µ–Ω–Ω—ã–µ checkpoint —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ logs/                          # –õ–æ–≥–∏ –≤ JSON
‚îî‚îÄ‚îÄ requirements.txt
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.yaml`:
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—Å–µ—Ä–∞ (URL, –∑–∞–¥–µ—Ä–∂–∫–∏, retry)
- **Async –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** (max_concurrent, batch_size, checkpoint_interval)
- –ü—É—Ç—å –∫ –≤—Ö–æ–¥–Ω–æ–º—É Excel —Ñ–∞–π–ª—É
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ structlog
- DEBUG —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
- JSON –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª–µ `logs/parser.log`
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –õ–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–¥–∏–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º
- **electronpribor**: ~36 –º–∏–Ω—É—Ç –¥–ª—è 8000 —Ç–æ–≤–∞—Ä–æ–≤
- **prist**: ~100 –º–∏–Ω—É—Ç –¥–ª—è 8000 —Ç–æ–≤–∞—Ä–æ–≤

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
- **electronpribor + prist**: ~100 –º–∏–Ω—É—Ç –¥–ª—è 8000 —Ç–æ–≤–∞—Ä–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è**: ~36 –º–∏–Ω—É—Ç (26%)

–û–±–∞ –ø–∞—Ä—Å–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –≤—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è —Å–∞–º—ã–º –º–µ–¥–ª–µ–Ω–Ω—ã–º –ø–∞—Ä—Å–µ—Ä–æ–º.

## Checkpoint –º–µ—Ö–∞–Ω–∏–∑–º

–ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ N —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `checkpoint_interval`)
- –§–∞–π–ª—ã –≤ `output/temp/checkpoint_parallel_*.xlsx`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ü—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏ (Ctrl+C) - checkpoint —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ

