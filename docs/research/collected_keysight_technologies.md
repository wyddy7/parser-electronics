# Шаблон сбора информации для создания парсеров

## Базовые данные
- **Сайт**: `Keysight Technologies`
- **Base URL**: `https://keysight-technologies.ru/`
- **Имя парсера** (snake_case): `keysight_technologies`

---

## 1. Поиск товаров

**URL паттерн:**
```
https://keysight-technologies.ru/index.php?route=product/search&search={query}&description=true
```

**Кодирование:**
- [x] `urllib.parse.quote()` (пробелы → `%20`)
- [ ] Замена пробелов на `+`
- [ ] Другое: `_________________`

**Примечание:** Используется URL-кодирование, обязательный параметр `description=true` для поиска в описаниях товаров

**Тестовый URL:**
- Товар: `Осциллографы InfiniiVision`
- URL: `https://keysight-technologies.ru/index.php?route=product/search&search=%D0%9E%D1%81%D1%86%D0%B8%D0%BB%D0%BB%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%8B%20InfiniiVision&description=true`

---

## 2. CSS Селекторы

**Контейнер результатов:**
```css
.products-block.row > .product-layout.product-grid
```

**Элемент товара:**
```css
.product-thumb
```
Или: `.product-layout.product-grid`

**Название:**
```css
.product-thumb__name
```

**Цена:**
```css
.option__item[data-price]
```
**ВАЖНО:** Основная цена `.product-thumb__price.price` показывает базовую цену (обычно 81 ₽), реальные цены находятся в опциях товара в атрибуте `data-price` или в `title` опции (например, `+ 43935 ₽`)

**Ссылка:**
```css
.product-thumb__name
```

**HTML пример товара:**
```html
<div class="product-thumb">
  <div class="product-thumb__caption">
    <a class="product-thumb__name" href="/katalog/oscillografy/1000а_g">
      Осциллографы InfiniiVision 1000А/G серии X (EDUX1052A/G, DSOX1202A/G, DSOX1204A/G)
    </a>
    <div class="product-thumb__option option">
      <div class="option__group">
        <label class="option__item">
          <input type="checkbox" data-price="43935.25650705" />
          <span class="option__name" title="+ 43935 ₽">EDUX1052A 50 МГц, 2 канала</span>
        </label>
        <label class="option__item">
          <input type="checkbox" data-price="77502.816" />
          <span class="option__name" title="+ 77503 ₽">EDUX1052G 50 МГц, 2 канала</span>
        </label>
      </div>
    </div>
    <div class="product-thumb__price price" data-price="80.7321">
      81 ₽
    </div>
  </div>
</div>
```

---

## 3. Цена

**Формат:**
- [x] `43935 ₽` или `159000 ₽` (без пробелов между тысячами, с пробелом перед ₽)
- [ ] `1000.00 ₽` (точка)
- [ ] `1,000 ₽` (запятая)
- [ ] Другое: `_________________`

**Примеры:**
- `43935 ₽` (цена из опции)
- `159000 ₽` (большие суммы)
- `144638 ₽` (разные варианты)

**ВАЖНО - Особенность цен:**
- Основная цена `.product-thumb__price.price` показывает базовую цену (обычно 81 ₽)
- **Реальные цены находятся в опциях товара** в атрибуте `data-price` или в `title` опции
- Нужно парсить цены из `.option__item[data-price]` или из `title` опции (формат: `+ 43935 ₽`)

**Особые случаи:**
- Диапазон цен: `_________________` → брать: `_________________`
- "По запросу": текст `_________________` (не обнаружено в примерах)
- "Снят": текст `_________________` (не обнаружено в примерах)

---

## 4. Страница товара

- [x] Цена в результатах поиска
- [ ] Нужен переход на страницу товара

**Примечание:** Цены находятся в опциях товара в результатах поиска

**Если нужна страница:**
- Селектор цены: `_________________`
- Селектор названия: `_________________`

---

## 5. Выбор товара

**Критерии:**
- [ ] Точное совпадение названия
- [ ] Совпадение артикула
- [x] Частичное совпадение (поиск работает по части названия и описания)

**ВАЖНО - Особенность поиска:**
- Поиск может не находить товары по запросу (проблема с релевантностью)
- **Нужна фильтрация результатов** по релевантности названия товара
- Используется параметр `description=true` для поиска в описаниях

**Приоритет:**
1. С ценой > "по запросу" > "снят"
2. Точное > частичное

---

## 6. Технические настройки

**Рекомендуемые значения:**
- `timeout`: `18-20` сек
- `request_delay`: `0.8-1.0` сек
- `max_concurrent`: `4-6`
- `batch_delay`: `4-5` сек

**Особенности:**
- Цены находятся в опциях товара, а не в основной цене
- Основная цена `.product-thumb__price.price` показывает базовую цену (81 ₽)
- Реальные цены нужно парсить из `.option__item[data-price]` или из `title` опции
- Поиск может не находить товары по запросу - нужна фильтрация результатов
- Обязательный параметр `description=true` в URL поиска
- Нет статусов "по запросу" или "снят" - только цены

---

## 7. Тестовые товары

1. `EDUX1052A` → цена: `43935 ₽` (из опции)
2. `DSOX2002A` → цена: `159000 ₽` (из опции)
3. `DSOX1204G` → цена: `144638 ₽` (из опции)
4. "По запросу": `_________________` (не обнаружено в примерах)
5. "Снят": `_________________` (не обнаружено в примерах)
6. Не найден: `_________________` (нужно протестировать, поиск может не находить товары)

**Примечание:** Поиск может не находить товары по запросу, нужна фильтрация результатов по релевантности

---

## 8. Конфигурация config.yaml

```yaml
parser:
  keysight_technologies:
    enabled: true
    base_url: "https://keysight-technologies.ru/"
    async:
      enabled: true
      max_concurrent: 4-6
      request_delay: 0.8-1.0
      batch_size: 20-30
      batch_delay: 4-5
    timeout: 18-20
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

---

## Чеклист готовности

- [x] Base URL
- [x] URL паттерн поиска
- [x] Селектор контейнера
- [x] Селектор товара
- [x] Селектор названия
- [x] Селектор цены
- [x] Селектор ссылки
- [x] Формат цены
- [x] Статусы ("по запросу", "снят")
- [x] Тестовые товары
- [x] Конфигурация

**Готово к реализации!** ✅

**ВАЖНО:** 
- Цены находятся в опциях товара (`.option__item[data-price]`), а не в основной цене
- Поиск может не находить товары по запросу - необходима фильтрация результатов по релевантности

