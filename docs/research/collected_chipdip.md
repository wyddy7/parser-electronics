# Шаблон сбора информации для создания парсеров

## Базовые данные
- **Сайт**: `ChipDip`
- **Base URL**: `https://www.chipdip.ru/`
- **Имя парсера** (snake_case): `chipdip`

---

## 1. Поиск товаров

**URL паттерн:**
```
https://www.chipdip.ru/search?searchtext={query}
```

**Кодирование:**
- [x] `urllib.parse.quote()` (пробелы → `%20`)
- [ ] Замена пробелов на `+`
- [ ] Другое: `_________________`

**Примечание:** Используется URL-кодирование для спецсимволов (например, `%2C` для запятой)

**Тестовый URL:**
- Товар: `ТОН, генератор кабельный мультичастотный`
- URL: `https://www.chipdip.ru/search?searchtext=%D0%A2%D0%9E%D0%9D%2C+%D0%B3%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80+%D0%BA%D0%B0%D0%B1%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9+%D0%BC%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D1%87%D0%B0%D1%81%D1%82%D0%BE%D1%82%D0%BD%D1%8B%D0%B9`

---

## 2. CSS Селекторы

**Контейнер результатов:**
```css
table.itemlist#itemlist > tr.with-hover
```

**Элемент товара:**
```css
tr.with-hover
```

**Название:**
```css
.name a.link
```

**Цена:**
```css
.price.price-main
```
Или: `#price_{id}` (динамический ID товара)

**Примечание:** Валюта в `.rub` (руб.)

**Ссылка:**
```css
.name a.link
```

**HTML пример товара:**
```html
<tr class="with-hover" id="item8010512328">
  <td class="h_name">
    <div class="name">
      <a class="link" href="/product/86213-lan-tester-kabelnyy-s-ton-generatorom-kt-801-kvt-8010512328">
        86213, LAN-тестер кабельный с тон-генератором KT 801 серия PROLINE (КВТ)
      </a>
    </div>
  </td>
  <td class="h_pr nw">
    <span class="price price-main">
      <span id="price_8010512328">5 530</span>
      <span class="rub"> руб.</span>
    </span>
  </td>
</tr>
```

---

## 3. Цена

**Формат:**
- [x] `5 530 руб.` или `37 руб.` (пробелы как разделители тысяч, используется `&#160;` между тысячами)
- [ ] `1000.00 ₽` (точка)
- [ ] `1,000 ₽` (запятая)
- [ ] Другое: `_________________`

**Примеры:**
- `5 530 руб.` (цена с пробелами между тысячами)
- `37 руб.` (цена меньше 1000)
- `9 440 руб.` (большие суммы)

**Особые случаи:**
- Диапазон цен: `_________________` → брать: `_________________`
- "По запросу": текст `_________________` (не обнаружено в примерах)
- "Снят": текст `_________________` (не обнаружено в примерах)

---

## 4. Страница товара

- [x] Цена в результатах поиска
- [ ] Нужен переход на страницу товара

**Если нужна страница:**
- Селектор цены: `_________________`
- Селектор названия: `_________________`

---

## 5. Выбор товара

**Критерии:**
- [ ] Точное совпадение названия
- [ ] Совпадение артикула
- [x] Частичное совпадение (поиск работает по совпадению любого текста)

**ВАЖНО - Особенность поиска:**
- Поиск работает плохо - ищет по совпадению любого текста в описании
- Находит много нерелевантных товаров даже при точном запросе
- **Нужна фильтрация результатов** по релевантности названия товара

**Приоритет:**
1. С ценой > "по запросу" > "снят"
2. Точное > частичное

---

## 6. Технические настройки

**Рекомендуемые значения:**
- `timeout`: `18-20` сек
- `request_delay`: `0.8-1.0` сек
- `max_concurrent`: `4-6`
- `batch_delay`: `4-5` сек

**Особенности:**
- Цена отображается в формате "5 530 руб." или "37 руб." (пробелы между тысячами через `&#160;`)
- Поиск работает плохо - ищет по совпадению любого текста, находит много нерелевантных товаров
- Нужна фильтрация результатов по релевантности названия товара
- Цена находится в `.price.price-main` или `#price_{id}`, валюта в `.rub`

---

## 7. Тестовые товары

1. `86213 LAN-тестер` → цена: `5 530 руб.` или `5 720 руб.` (несколько вариантов)
2. `STV6888` → цена: `37 руб.`
3. `HT-461` → цена: `3 220 руб.` (но "Нет в наличии")
4. "По запросу": `_________________` (не обнаружено в примерах)
5. "Снят": `_________________` (не обнаружено в примерах)
6. Не найден: `_________________` (нужно протестировать)

**Примечание:** Поиск находит много нерелевантных товаров, нужна фильтрация по релевантности

---

## 8. Конфигурация config.yaml

```yaml
parser:
  chipdip:
    enabled: true
    base_url: "https://www.chipdip.ru/"
    async:
      enabled: true
      max_concurrent: 4-6
      request_delay: 0.8-1.0
      batch_size: 20-30
      batch_delay: 4-5
    timeout: 18-20
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

---

## Чеклист готовности

- [x] Base URL
- [x] URL паттерн поиска
- [x] Селектор контейнера
- [x] Селектор товара
- [x] Селектор названия
- [x] Селектор цены
- [x] Селектор ссылки
- [x] Формат цены
- [x] Статусы ("по запросу", "снят")
- [x] Тестовые товары
- [x] Конфигурация

**Готово к реализации!** ✅

**ВАЖНО:** Поиск на ChipDip работает плохо - находит много нерелевантных товаров. Необходимо реализовать фильтрацию результатов по релевантности названия товара к поисковому запросу.

